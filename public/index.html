<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Finder Hong Kong</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide-react@0.292.0/dist/lucide-react.js"></script>
    <style>
        /* Simple fade-in animation for results */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        // --- React Component Starts Here ---

        const { useState, useCallback } = React;
        // CORRECTED LINE: The icon library uses the global variable "LucideReact", not "lucide".
        const { Search, Clock, Users, Calendar, ExternalLink, ThumbsDown, ThumbsUp, LoaderCircle } = LucideReact;

        // Helper component for loading spinner
        const LoadingSpinner = () => (
            <LoaderCircle className="animate-spin h-5 w-5 mr-3" />
        );

        // Helper component for individual result items
        const ResultItem = ({ restaurant, isAvailable }) => (
            <a
                href={restaurant.url}
                target="_blank"
                rel="noopener noreferrer"
                className="block p-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 group"
            >
                <div className="flex justify-between items-center">
                    <div className="flex items-center">
                        {isAvailable ? (
                            <ThumbsUp className="h-5 w-5 text-green-500 mr-3 flex-shrink-0" />
                        ) : (
                            <ThumbsDown className="h-5 w-5 text-red-500 mr-3 flex-shrink-0" />
                        )}
                        <span className="font-medium text-gray-800 dark:text-gray-200">{restaurant.name}</span>
                    </div>
                    <ExternalLink className="h-4 w-4 text-gray-400 dark:text-gray-500 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors duration-200" />
                </div>
            </a>
        );

        // Main Application Component
        function RestaurantFinder() {
            const [query, setQuery] = useState({
                date: new Date().toISOString().split('T')[0],
                partySize: '2',
                time: '19:00',
            });
            const [results, setResults] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const handleInputChange = (e) => {
                setQuery({ ...query, [e.target.name]: e.target.value });
            };

            const handleSubmit = useCallback(async (e) => {
                e.preventDefault();
                setLoading(true);
                setResults(null);
                setError(null);

                const params = new URLSearchParams(query);
                try {
                    // This relative URL works perfectly when deployed on Vercel
                    const response = await fetch(`/api/check?${params.toString()}`);
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.details || `An error occurred while searching.`);
                    }
                    const data = await response.json();
                    setResults(data);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            }, [query]);
            
            const timeOptions = ['18:00', '18:30', '19:00', '19:30', '20:00', '20:30', '21:00'];
            const partySizeOptions = Array.from({ length: 10 }, (_, i) => String(i + 1));

            return (
                <div className="container mx-auto p-4 md:p-8 max-w-2xl">
                    <header className="text-center mb-10">
                        <h1 className="text-4xl font-bold text-gray-900 dark:text-white mb-2">Table Finder</h1>
                        <p className="text-lg text-gray-600 dark:text-gray-400">The fastest way to find a table in Hong Kong.</p>
                    </header>

                    <main>
                        <div className="bg-white dark:bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <form onSubmit={handleSubmit}>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div className="relative">
                                        <Calendar className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                                        <input
                                            type="date"
                                            name="date"
                                            value={query.date}
                                            onChange={handleInputChange}
                                            className="w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
                                            required
                                        />
                                    </div>
                                    <div className="relative">
                                        <Users className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                                        <select name="partySize" value={query.partySize} onChange={handleInputChange} className="w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 appearance-none transition">
                                            {partySizeOptions.map(size => <option key={size} value={size}>{size} people</option>)}
                                        </select>
                                    </div>
                                    <div className="relative">
                                        <Clock className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                                        <select name="time" value={query.time} onChange={handleInputChange} className="w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 appearance-none transition">
                                            {timeOptions.map(time => <option key={time} value={time}>{time}</option>)}
                                        </select>
                                    </div>
                                </div>
                                <button type="submit" disabled={loading} className="mt-6 w-full flex items-center justify-center bg-indigo-600 text-white font-semibold py-3 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400 dark:disabled:bg-indigo-800 transition-all duration-300 ease-in-out">
                                    {loading ? <LoadingSpinner /> : <Search className="h-5 w-5 mr-3" />}
                                    {loading ? 'Searching...' : 'Find Tables'}
                                </button>
                            </form>
                        </div>

                        {error && (
                            <div className="mt-8 p-4 bg-red-100 dark:bg-red-900 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-200 rounded-lg">
                                <p className="font-bold">An error occurred:</p>
                                <p className="text-sm">{error}</p>
                            </div>
                        )}

                        {results && !loading && (
                            <div className="mt-10 animate-fade-in">
                                {results.available && results.available.length > 0 && (
                                    <section className="mb-8">
                                        <h2 className="text-2xl font-semibold mb-4 text-gray-900 dark:text-white flex items-center">
                                            <ThumbsUp className="h-6 w-6 text-green-500 mr-3" />
                                            Available
                                        </h2>
                                        <div className="grid grid-cols-1 gap-3">
                                            {results.available.map((r) => <ResultItem key={r.name} restaurant={r} isAvailable={true} />)}
                                        </div>
                                    </section>
                                )}

                                {results.unavailable && results.unavailable.length > 0 && (
                                    <section>
                                        <h2 className="text-2xl font-semibold mb-4 text-gray-900 dark:text-white flex items-center">
                                            <ThumbsDown className="h-6 w-6 text-red-500 mr-3" />
                                            Unavailable
                                        </h2>
                                        <div className="grid grid-cols-1 gap-3">
                                        {results.unavailable.map((r) => <ResultItem key={r.name} restaurant={r} isAvailable={false} />)}
                                        </div>
                                    </section>
                                )}
                                
                                {results.available.length === 0 && results.unavailable.length === 0 && (
                                <div className="text-center py-10">
                                    <p className="text-lg text-gray-500">No results found for your search criteria.</p>
                                </div>
                                )}
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<RestaurantFinder />);
    </script>
</body>
</html>

