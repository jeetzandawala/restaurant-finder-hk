<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Finder Hong Kong</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Keyframes for animations */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        /* Animation utility classes */
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        // --- React Component Starts Here ---
        const { useState, useCallback } = React;

        // --- SVG Icon Components (Replaces external library) ---
        const Icon = ({ className, children }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const SearchIcon = ({ className }) => <Icon className={className}><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></Icon>;
        const ClockIcon = ({ className }) => <Icon className={className}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></Icon>;
        const UsersIcon = ({ className }) => <Icon className={className}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></Icon>;
        const CalendarIcon = ({ className }) => <Icon className={className}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></Icon>;
        const ExternalLinkIcon = ({ className }) => <Icon className={className}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></Icon>;
        const ThumbsDownIcon = ({ className }) => <Icon className={className}><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></Icon>;
        const ThumbsUpIcon = ({ className }) => <Icon className={className}><path d="M7 10v12"></path><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3 3 0 0 1 3 3.12v.76Z"></path></Icon>;
        const LoaderCircleIcon = ({ className }) => <Icon className={className}><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></Icon>;

        // Helper component for loading spinner
        const LoadingSpinner = () => (
            <LoaderCircleIcon className="animate-spin h-5 w-5 mr-3" />
        );

        // Helper component for individual result items
        const ResultItem = ({ restaurant, isAvailable }) => (
            <a href={restaurant.url} target="_blank" rel="noopener noreferrer" className="block p-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 group">
                <div className="flex justify-between items-center">
                    <div className="flex items-center">
                        {isAvailable ? <ThumbsUpIcon className="h-5 w-5 text-green-500 mr-3 flex-shrink-0" /> : <ThumbsDownIcon className="h-5 w-5 text-red-500 mr-3 flex-shrink-0" />}
                        <span className="font-medium text-gray-800 dark:text-gray-200">{restaurant.name}</span>
                    </div>
                    <ExternalLinkIcon className="h-4 w-4 text-gray-400 dark:text-gray-500 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors duration-200" />
                </div>
            </a>
        );

        // Main Application Component
        function RestaurantFinder() {
            const [query, setQuery] = useState({ date: new Date().toISOString().split('T')[0], partySize: '2', time: '19:00' });
            const [results, setResults] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const handleInputChange = (e) => setQuery({ ...query, [e.target.name]: e.target.value });

            const handleSubmit = useCallback(async (e) => {
                e.preventDefault();
                setLoading(true);
                setResults(null);
                setError(null);
                const params = new URLSearchParams(query);
                try {
                    const response = await fetch(`/api/check?${params.toString()}`);
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.details || `An error occurred while searching.`);
                    }
                    setResults(await response.json());
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            }, [query]);
            
            const timeOptions = ['18:00', '18:30', '19:00', '19:30', '20:00', '20:30', '21:00'];
            const partySizeOptions = Array.from({ length: 10 }, (_, i) => String(i + 1));

            return (
                <div className="container mx-auto p-4 md:p-8 max-w-2xl">
                    <header className="text-center mb-10">
                        <h1 className="text-4xl font-bold text-gray-900 dark:text-white mb-2">Table Finder</h1>
                        <p className="text-lg text-gray-600 dark:text-gray-400">The fastest way to find a table in Hong Kong.</p>
                    </header>

                    <main>
                        <div className="bg-white dark:bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <form onSubmit={handleSubmit}>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div className="relative">
                                        <CalendarIcon className="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                                        <input type="date" name="date" value={query.date} onChange={handleInputChange} className="w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" required />
                                    </div>
                                    <div className="relative">
                                        <UsersIcon className="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                                        <select name="partySize" value={query.partySize} onChange={handleInputChange} className="w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 appearance-none transition">
                                            {partySizeOptions.map(size => <option key={size} value={size}>{size} people</option>)}
                                        </select>
                                    </div>
                                    <div className="relative">
                                        <ClockIcon className="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                                        <select name="time" value={query.time} onChange={handleInputChange} className="w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 appearance-none transition">
                                            {timeOptions.map(time => <option key={time} value={time}>{time}</option>)}
                                        </select>
                                    </div>
                                </div>
                                <button type="submit" disabled={loading} className="mt-6 w-full flex items-center justify-center bg-indigo-600 text-white font-semibold py-3 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400 dark:disabled:bg-indigo-800 transition-all duration-300 ease-in-out">
                                    {loading ? <LoadingSpinner /> : <SearchIcon className="h-5 w-5 mr-3" />}
                                    {loading ? 'Searching...' : 'Find Tables'}
                                </button>
                            </form>
                        </div>

                        {error && <div className="mt-8 p-4 bg-red-100 dark:bg-red-900 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-200 rounded-lg"><p className="font-bold">An error occurred:</p><p className="text-sm">{error}</p></div>}

                        {results && !loading && (
                            <div className="mt-10 animate-fade-in">
                                {results.available && results.available.length > 0 && (
                                    <section className="mb-8">
                                        <h2 className="text-2xl font-semibold mb-4 text-gray-900 dark:text-white flex items-center"><ThumbsUpIcon className="h-6 w-6 text-green-500 mr-3" />Available</h2>
                                        <div className="grid grid-cols-1 gap-3">{results.available.map((r) => <ResultItem key={r.name} restaurant={r} isAvailable={true} />)}</div>
                                    </section>
                                )}
                                {results.unavailable && results.unavailable.length > 0 && (
                                    <section>
                                        <h2 className="text-2xl font-semibold mb-4 text-gray-900 dark:text-white flex items-center"><ThumbsDownIcon className="h-6 w-6 text-red-500 mr-3" />Unavailable</h2>
                                        <div className="grid grid-cols-1 gap-3">{results.unavailable.map((r) => <ResultItem key={r.name} restaurant={r} isAvailable={false} />)}</div>
                                    </section>
                                )}
                                {results.available.length === 0 && results.unavailable.length === 0 && <div className="text-center py-10"><p className="text-lg text-gray-500">No results found for your search criteria.</p></div>}
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<RestaurantFinder />);
    </script>
</body>
</html>

